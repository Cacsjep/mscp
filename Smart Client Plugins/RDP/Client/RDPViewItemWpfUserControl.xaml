<external:ViewItemWpfUserControl
    xmlns:external="clr-namespace:VideoOS.Platform.Client;assembly=VideoOS.Platform"
    x:Class="RDP.Client.RDPViewItemWpfUserControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:wfi="clr-namespace:System.Windows.Forms.Integration;assembly=WindowsFormsIntegration"
    mc:Ignorable="d"
    d:DesignHeight="400"
    d:DesignWidth="600"
    PreviewMouseLeftButtonUp="OnMouseLeftUp"
    PreviewMouseDoubleClick="OnMouseDoubleClick">
    <Grid Background="#FF1C2326">
        <Grid.Resources>
            <!-- Dark-themed button style -->
            <Style x:Key="DarkButton" TargetType="Button">
                <Setter Property="Background" Value="#FF2A5A8A" />
                <Setter Property="Foreground" Value="White" />
                <Setter Property="BorderBrush" Value="#FF3A6A9A" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Cursor" Value="Hand" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="3"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#FF3A6A9A" />
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Background" Value="#FF1A4A7A" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <!-- Dark-themed password box style -->
            <Style x:Key="DarkPasswordBox" TargetType="PasswordBox">
                <Setter Property="Background" Value="#FF2A3040" />
                <Setter Property="Foreground" Value="White" />
                <Setter Property="CaretBrush" Value="White" />
                <Setter Property="BorderBrush" Value="#FF3A4A5A" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="PasswordChar" Value="&#x25CF;" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="Padding" Value="8,6" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="PasswordBox">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="3"
                                    Padding="{TemplateBinding Padding}">
                                <ScrollViewer x:Name="PART_ContentHost"
                                              VerticalAlignment="Center" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF5A8ABB" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <!-- Dark-themed toolbar button style -->
            <Style x:Key="ToolbarButton" TargetType="Button">
                <Setter Property="Background" Value="#FF2A3A4A" />
                <Setter Property="Foreground" Value="#FFCCCCCC" />
                <Setter Property="BorderBrush" Value="#FF3A4A5A" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Cursor" Value="Hand" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="2"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#FF3A4A5A" />
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Background" Value="#FF1A2A3A" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </Grid.Resources>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Connected toolbar (only visible when connected) -->
        <Border x:Name="connectedToolbar" Grid.Row="0" Background="#FF070809" Padding="6,4"
                Visibility="Collapsed">
            <DockPanel>
                <TextBlock x:Name="statusText"
                           DockPanel.Dock="Right"
                           Foreground="#FF88BBFF"
                           FontSize="12"
                           VerticalAlignment="Center"
                           Margin="8,0,4,0"
                           TextTrimming="CharacterEllipsis" />
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Button x:Name="disconnectButton"
                            Content="Disconnect"
                            Padding="12,3"
                            FontSize="12"
                            Style="{StaticResource ToolbarButton}"
                            Click="DisconnectButton_Click" />
                    <TextBlock x:Name="toolbarNameText"
                               Foreground="#FFCCCCCC"
                               FontSize="12"
                               VerticalAlignment="Center"
                               Margin="10,0,0,0" />
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- Main area -->
        <Grid Grid.Row="1">
            <!-- RDP host (hidden until connected) -->
            <WindowsFormsHost x:Name="rdpHost" Visibility="Collapsed" />

            <!-- Connecting overlay (covers white RDP host while connecting) -->
            <Grid x:Name="connectingOverlay" Background="#FF1C2326" Visibility="Collapsed">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <!-- Spinning arc -->
                    <Canvas Width="40" Height="40" HorizontalAlignment="Center" Margin="0,0,0,16">
                        <Ellipse Width="40" Height="40"
                                 Stroke="#FF2A3A4A" StrokeThickness="4" />
                        <Path x:Name="spinnerArc"
                              Stroke="#FF88BBFF" StrokeThickness="4" StrokeStartLineCap="Round" StrokeEndLineCap="Round"
                              Data="M 20,2 A 18,18 0 0 1 38,20">
                            <Path.RenderTransform>
                                <RotateTransform x:Name="spinnerRotate" Angle="0" CenterX="20" CenterY="20" />
                            </Path.RenderTransform>
                        </Path>
                    </Canvas>
                    <TextBlock x:Name="connectingNameText"
                               Foreground="White"
                               FontSize="18"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,4" />
                    <TextBlock Text="Connecting..."
                               Foreground="#FF88BBFF"
                               FontSize="13"
                               HorizontalAlignment="Center" />
                    <TextBlock x:Name="connectingInfoText"
                               Foreground="#FF666666"
                               FontSize="12"
                               HorizontalAlignment="Center"
                               Margin="0,6,0,0" />
                </StackPanel>
            </Grid>

            <!-- Login overlay (shown when disconnected in live mode) -->
            <Grid x:Name="loginOverlay" Background="#FF1C2326">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Width="300">
                    <TextBlock x:Name="loginNameText"
                               Foreground="White"
                               FontSize="22"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,2" />
                    <TextBlock Text="Remote Desktop Connection"
                               Foreground="#FFAAAAAA"
                               FontSize="13"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,6" />
                    <TextBlock x:Name="overlayInfoText"
                               Foreground="#FF88BBFF"
                               FontSize="13"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,20"
                               TextAlignment="Center" />

                    <!-- Login form -->
                    <StackPanel x:Name="loginForm">
                        <TextBlock Text="Password"
                                   Foreground="#FF999999"
                                   FontSize="12"
                                   Margin="0,0,0,4" />
                        <PasswordBox x:Name="loginPasswordBox"
                                     Style="{StaticResource DarkPasswordBox}"
                                     Margin="0,0,0,12" />
                        <Button x:Name="connectButton"
                                Content="Connect"
                                Padding="12,8"
                                FontSize="13"
                                HorizontalAlignment="Stretch"
                                Style="{StaticResource DarkButton}"
                                Click="ConnectButton_Click" />
                    </StackPanel>

                    <!-- Error text -->
                    <TextBlock x:Name="overlayErrorText"
                               Foreground="#FFFF6B6B"
                               FontSize="12"
                               HorizontalAlignment="Center"
                               Margin="0,14,0,0"
                               TextWrapping="Wrap"
                               TextAlignment="Center" />
                </StackPanel>
            </Grid>

            <!-- Setup mode overlay (no login form, just info) -->
            <Grid x:Name="setupOverlay" Background="#FF1C2326" Visibility="Collapsed">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock x:Name="setupNameText"
                               Foreground="White"
                               FontSize="22"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,2" />
                    <TextBlock Text="Remote Desktop Connection"
                               Foreground="#FFAAAAAA"
                               FontSize="13"
                               HorizontalAlignment="Center" />
                    <TextBlock x:Name="setupInfoText"
                               Foreground="#FF88BBFF"
                               FontSize="13"
                               HorizontalAlignment="Center"
                               Margin="0,10,0,0"
                               TextAlignment="Center" />
                    <TextBlock Text="Configure IP and Username in the Properties panel"
                               Foreground="#FF666666"
                               FontSize="11"
                               HorizontalAlignment="Center"
                               Margin="0,8,0,0" />
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</external:ViewItemWpfUserControl>
